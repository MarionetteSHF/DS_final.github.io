<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Regression Analysis</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Time.html">Time-Part</a>
</li>
<li>
  <a href="map.html">map</a>
</li>
<li>
  <a href="Reasons-for-bus-delay.html">reason-part</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="test_zhl.html">Test</a>
    </li>
    <li>
      <a href="regression.html">Regression</a>
    </li>
  </ul>
</li>
<li>
  <a href="Report.html">Report</a>
</li>
<li>
  <a href="https://github.com/MarionetteSHF/DS_final.github.io">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Regression Analysis</h1>

</div>


<div id="predicting-model-for-daily-delay-account" class="section level2">
<h2>Predicting Model for Daily Delay Account</h2>
<p>From previously data exploration and data analysis, we know that there exists some interesting relationship between bus delay and weather,location, and a variety of reasons.Here, we want to explore the dataset more deeper to predict the number of daily delay in Manhattan as our outcome and month, weekday, reasons,daily precipitation,run type of bus, daily snow depth as predictors.</p>
<p>Our interested dependent variable is number of delay across three school years: the amount of delay in Manhattan. We can interpret that this dependent is following poison distribution, so we need to consider regression model for this settings. Based on the graph below, the daily delay across three consecutive school have declined.</p>
<pre class="r"><code>daily_df = df %&gt;% 
  filter(school_year!=&quot;2021-2022&quot;,
         boro ==&quot;Manhattan&quot;) %&gt;% 
   group_by(occur_date,school_year) %&gt;% 
   summarize(n=n()) %&gt;% 
    ggplot(aes(x=occur_date, y=n,fill=school_year))+
    geom_bar(stat=&#39;identity&#39;)+
    facet_grid(~school_year)+
      labs(
        title = &quot;Number of Daily Delay&quot;,
        x = &quot;Date of Delay&quot;,
        y = &quot;Count&quot;
      )
daily_df</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-1-1.png" width="768" /></p>
<p>Here’s the predictors in our model:</p>
<p> ·<strong>month</strong>: month of the incident occurred;</p>
<p> ·<strong>day</strong>: weekday of the incident occurred;</p>
<p> ·<strong>reason</strong> : reason for delay as entered by staff employed by reporting bus vendor;</p>
<p> ·<strong>prcp</strong>:precipitation (tenths of mm)</p>
<p> ·<strong>run_type</strong>:designates whether a breakdown or delay occurred on a specific category of busing service;</p>
<p> ·<strong>snwd</strong>: snow depth (mm)</p>
<p> ·<strong>tmin</strong> Minimum temperature (tenths of degrees C)</p>
</div>
<div id="fitting-model" class="section level2">
<h2>Fitting Model</h2>
<p>We propose 4 models for prediction:</p>
<p> 1. Linear Model of daily_delay ~ month + day + snwd + tmin</p>
<p> 2. Linear Model of daily_delay ~ month + day + snwd + tmin+ tmin*day,assuming that there are interaction</p>
<p> 3. Linear Model of daily_delay ~ month + day + prcp</p>
<p> 4. Step_wise Regression Model of daily_delay ~ month + day + prcp + snwd+ tmin</p>
<pre class="r"><code>cv_df=df %&gt;% 
  sample_n(size = 100) %&gt;% 
  group_by(occur_date) %&gt;% 
  mutate(daily_delay=n()) %&gt;% 
  modelr::crossv_mc(n = 100) %&gt;%
  mutate_if(is.character, as.factor) %&gt;% 
  mutate(train = map(train, as.tibble), 
         test = map(test, as.tibble)) %&gt;% 
  mutate(lm_1 = map(.x = train,~ lm(daily_delay ~ month + day  + snwd + tmin,data = .x)),
         lm_2 =map(.x = train,~ lm(daily_delay ~ month + day+ snwd + tmin+tmin*day,data = .x)),
         lm_3 =map(.x = train,~ lm(daily_delay ~ month + day+ prcp, data = .x)))</code></pre>
<pre class="r"><code>cv=cv_df %&gt;% 
  select(starts_with(&quot;lm&quot;)) %&gt;% 
  pivot_longer(
    starts_with(&quot;lm&quot;),
    names_to = &quot;model&quot;,
    values_to = &quot;data&quot;) %&gt;% 
  mutate(data = map(data,broom::tidy))

cv %&gt;%
  filter(model == &quot;lm_1&quot;) %&gt;%
  unnest(data) </code></pre>
<pre><code>## # A tibble: 1,600 × 6
##    model term           estimate std.error statistic       p.value
##    &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1 lm_1  (Intercept)      1.91       0.286     6.70  0.00000000674
##  2 lm_1  monthDecember   -0.327      0.294    -1.11  0.271        
##  3 lm_1  monthFebruary    0.162      0.285     0.568 0.572        
##  4 lm_1  monthJanuary    -0.341      0.367    -0.930 0.356        
##  5 lm_1  monthJune       -0.455      0.422    -1.08  0.286        
##  6 lm_1  monthMarch       0.0664     0.313     0.212 0.833        
##  7 lm_1  monthMay        -0.0378     0.347    -0.109 0.914        
##  8 lm_1  monthNovember   -0.331      0.280    -1.18  0.241        
##  9 lm_1  monthOctober    -0.554      0.305    -1.82  0.0738       
## 10 lm_1  monthSeptember  -0.452      0.409    -1.10  0.274        
## # … with 1,590 more rows</code></pre>
<pre class="r"><code>cv %&gt;%
  filter(model == &quot;lm_2&quot;) %&gt;%
  unnest(data) </code></pre>
<pre><code>## # A tibble: 2,000 × 6
##    model term           estimate std.error statistic  p.value
##    &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 lm_2  (Intercept)      2.42       0.288     8.41  1.11e-11
##  2 lm_2  monthDecember   -0.574      0.276    -2.08  4.21e- 2
##  3 lm_2  monthFebruary    0.183      0.269     0.681 4.98e- 1
##  4 lm_2  monthJanuary    -0.584      0.348    -1.68  9.89e- 2
##  5 lm_2  monthJune        0.0698     0.439     0.159 8.74e- 1
##  6 lm_2  monthMarch      -0.231      0.298    -0.776 4.41e- 1
##  7 lm_2  monthMay         0.294      0.347     0.849 3.99e- 1
##  8 lm_2  monthNovember   -0.407      0.263    -1.55  1.26e- 1
##  9 lm_2  monthOctober    -0.340      0.288    -1.18  2.42e- 1
## 10 lm_2  monthSeptember  -0.106      0.390    -0.273 7.86e- 1
## # … with 1,990 more rows</code></pre>
<pre class="r"><code>cv %&gt;%
  filter(model == &quot;lm_3&quot;) %&gt;%
  unnest(data) </code></pre>
<pre><code>## # A tibble: 1,500 × 6
##    model term           estimate std.error statistic       p.value
##    &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1 lm_3  (Intercept)      1.77       0.264    6.71   0.00000000588
##  2 lm_3  monthDecember   -0.109      0.284   -0.384  0.702        
##  3 lm_3  monthFebruary    0.185      0.271    0.682  0.498        
##  4 lm_3  monthJanuary    -0.225      0.335   -0.672  0.504        
##  5 lm_3  monthJune       -0.382      0.368   -1.04   0.303        
##  6 lm_3  monthMarch       0.132      0.289    0.457  0.649        
##  7 lm_3  monthMay        -0.0251     0.313   -0.0800 0.936        
##  8 lm_3  monthNovember   -0.303      0.273   -1.11   0.271        
##  9 lm_3  monthOctober    -0.523      0.290   -1.80   0.0762       
## 10 lm_3  monthSeptember  -0.306      0.375   -0.815  0.418        
## # … with 1,490 more rows</code></pre>
<pre class="r"><code>df_1=df %&gt;% 
  group_by(occur_date) %&gt;% 
  mutate(daily_delay=n()) %&gt;% 
  ungroup(occur_date) %&gt;% 
  select(everything())

multi.fit=lm(daily_delay~month + day + prcp  + snwd+ tmin, data=df_1)

summary(multi.fit)</code></pre>
<pre><code>## 
## Call:
## lm(formula = daily_delay ~ month + day + prcp + snwd + tmin, 
##     data = df_1)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -233.7  -35.9   12.4   40.3  119.0 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    130.34001    1.14697  113.64  &lt; 2e-16 ***
## monthDecember   71.37443    1.26607   56.37  &lt; 2e-16 ***
## monthFebruary   69.92198    1.28330   54.49  &lt; 2e-16 ***
## monthJanuary    56.46312    1.27061   44.44  &lt; 2e-16 ***
## monthJune       30.12089    1.53009   19.69  &lt; 2e-16 ***
## monthMarch      53.09433    1.24254   42.73  &lt; 2e-16 ***
## monthMay        38.68639    1.30074   29.74  &lt; 2e-16 ***
## monthNovember   92.51235    1.17221   78.92  &lt; 2e-16 ***
## monthOctober   111.17046    1.15440   96.30  &lt; 2e-16 ***
## monthSeptember 106.57404    1.32609   80.37  &lt; 2e-16 ***
## dayMonday       15.53969    0.75741   20.52  &lt; 2e-16 ***
## dayThursday      2.61401    0.74148    3.53  0.00042 ***
## dayTuesday       8.56736    0.74749   11.46  &lt; 2e-16 ***
## dayWednesday     5.68897    0.74309    7.66  1.9e-14 ***
## prcp             0.07600    0.00296   25.71  &lt; 2e-16 ***
## snwd            -0.51022    0.01150  -44.38  &lt; 2e-16 ***
## tmin            -3.65887    0.05667  -64.56  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 58.7 on 62221 degrees of freedom
## Multiple R-squared:  0.306,  Adjusted R-squared:  0.306 
## F-statistic: 1.71e+03 on 16 and 62221 DF,  p-value: &lt;2e-16</code></pre>
<pre class="r"><code>step(multi.fit, direction=&#39;both&#39;)</code></pre>
<pre><code>## Start:  AIC=506860
## daily_delay ~ month + day + prcp + snwd + tmin
## 
##         Df Sum of Sq      RSS    AIC
## &lt;none&gt;               2.14e+08 506860
## - day    4   1726245 2.16e+08 507352
## - prcp   1   2274764 2.16e+08 507516
## - snwd   1   6778341 2.21e+08 508798
## - tmin   1  14345529 2.28e+08 510894
## - month  9  57893188 2.72e+08 521736</code></pre>
<pre><code>## 
## Call:
## lm(formula = daily_delay ~ month + day + prcp + snwd + tmin, 
##     data = df_1)
## 
## Coefficients:
##    (Intercept)   monthDecember   monthFebruary    monthJanuary       monthJune  
##        130.340          71.374          69.922          56.463          30.121  
##     monthMarch        monthMay   monthNovember    monthOctober  monthSeptember  
##         53.094          38.686          92.512         111.170         106.574  
##      dayMonday     dayThursday      dayTuesday    dayWednesday            prcp  
##         15.540           2.614           8.567           5.689           0.076  
##           snwd            tmin  
##         -0.510          -3.659</code></pre>
</div>
<div id="cross-validation" class="section level2">
<h2>Cross Validation</h2>
<p>Predictors we chose above are statistically significant.However,we notice that interaction terms are not contributing to model predictability.We would say lm_1 and lm_3 might be a bit better than lm-2.</p>
<pre class="r"><code>cv_df %&gt;% 
  mutate(
    rmse_lm1 = map2_dbl(lm_1, test, ~rmse(model = .x, data = .y)),
    rmse_lm2 = map2_dbl(lm_2, test, ~rmse(model = .x, data = .y)),
    rmse_lm3 = map2_dbl(lm_3, test, ~rmse(model = .x, data = .y))) %&gt;% 
  select(starts_with(&quot;rmse&quot;)) %&gt;% 
  pivot_longer(
    everything(),
    names_to = &quot;model&quot;, 
    values_to = &quot;rmse&quot;,
    names_prefix = &quot;rmse_&quot;) %&gt;% 
  mutate(model = fct_inorder(model)) %&gt;% 
  ggplot(aes(x = model, y = rmse)) + geom_violin()</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-7-1.png" width="768" /></p>
</div>
<div id="model-conclusion" class="section level2">
<h2>Model Conclusion</h2>
<p>Month,rainfall,snow depth, and day are good predictors for anticipating the number of daily delay in Manhattan.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
